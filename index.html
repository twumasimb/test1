<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessible Weather Dashboard – Search & 24-Hour Forecast</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #f1f5f9;
            --surface: #ffffff;
            --text: #1a202c;
            --text-secondary: #475569;
            --danger: #b91c1c;
            --border: #e5e7eb;
            --focus: #0066cc;
        }

        html {
            box-sizing: border-box;
            font-size: 100%;
            background: var(--secondary);
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }
        body {
            margin: 0;
            font-family: system-ui, Arial, sans-serif;
            color: var(--text);
            background: var(--secondary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            background: var(--primary);
            color: #fff;
            padding: 1rem 0;
        }
        nav {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .nav-title {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 0.02em;
        }
        main {
            flex: 1 0 auto;
            max-width: 900px;
            margin: 2rem auto 0 auto;
            padding: 0 1rem;
        }
        h1 {
            font-size: 2rem;
            margin-bottom: 0.5em;
        }
        form {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: flex-end;
            background: var(--surface);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.06);
            padding: 1rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }
        .form-group {
            display: flex;
            flex-direction: column;
            flex: 1 1 200px;
            min-width: 200px;
        }
        label {
            font-weight: 600;
            margin-bottom: 0.4em;
        }
        input[type="text"] {
            padding: 0.5em;
            font-size: 1rem;
            border: 1.5px solid var(--border);
            border-radius: 4px;
            background: #fff;
            color: var(--text);
            transition: border-color 0.2s;
        }
        input[type="text"]:focus {
            border-color: var(--primary);
        }
        .required {
            color: var(--danger);
            font-size: 1.1em;
            margin-left: 0.2em;
        }
        button[type="submit"] {
            background: var(--primary);
            color: #fff;
            border: none;
            padding: 0.7em 1.5em;
            font-size: 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        button[type="submit"]:hover,
        button[type="submit"]:focus {
            background: var(--primary-dark);
        }
        /* Focus indicators for all interactive elements */
        button:focus, input:focus, select:focus, textarea:focus, a:focus {
            outline: 3px solid var(--focus);
            outline-offset: 2px;
        }
        /* Error message styles */
        .error-message {
            color: var(--danger);
            font-size: 1rem;
            margin-top: 0.3em;
        }
        /* Weather section styles */
        .weather-section {
            background: var(--surface);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.06);
            padding: 1.5rem 1rem;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }
        .current-weather {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .weather-icon {
            width: 80px;
            height: 80px;
            flex-shrink: 0;
        }
        .weather-details {
            flex: 1 1 220px;
        }
        .weather-details h2 {
            margin: 0 0 0.5em 0;
            font-size: 1.3rem;
        }
        .temperature {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-dark);
        }
        .condition {
            font-size: 1.1rem;
            color: var(--text-secondary);
        }
        .forecast-section {
            margin-top: 1.5rem;
        }
        .forecast-section h2 {
            font-size: 1.2rem;
            margin-bottom: 1em;
        }
        .forecast-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 1.2rem;
        }
        .forecast-item {
            background: var(--secondary);
            border-radius: 6px;
            padding: 0.8em 0.5em;
            text-align: center;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .forecast-time {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.4em;
        }
        .forecast-temp {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-dark);
        }
        .forecast-condition {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-top: 0.2em;
        }
        .forecast-icon {
            width: 40px;
            height: 40px;
            margin-bottom: 0.2em;
        }
        /* Responsive Design */
        @media (max-width: 600px) {
            .current-weather {
                flex-direction: column;
                align-items: flex-start;
            }
            .forecast-list {
                grid-template-columns: repeat(2, 1fr);
            }
            nav {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
        }
        @media (max-width: 400px) {
            .forecast-list {
                grid-template-columns: 1fr;
            }
        }
        footer {
            background: var(--primary-dark);
            color: #fff;
            padding: 1rem 0;
            text-align: center;
            font-size: 0.95rem;
            flex-shrink: 0;
        }
        /* High contrast focus for dark backgrounds (none in this design, but included for completeness) */
        .dark-bg button:focus, .dark-bg a:focus {
            outline: 3px solid #ffffff;
        }
        /* Hide visually but remain accessible to screen readers */
        .sr-only {
            position: absolute !important;
            width: 1px; height: 1px;
            padding: 0; margin: -1px;
            overflow: hidden; clip: rect(0,0,0,0);
            white-space: nowrap; border: 0;
        }
    </style>
</head>
<body>
    <header>
        <nav role="navigation" aria-label="Main navigation">
            <span class="nav-title">Weather Dashboard</span>
            <a href="#main-content" class="skip-link" style="color: #fff; background: #1e293b; padding: 0.3em 0.7em; border-radius: 4px; text-decoration: none; font-size: 1rem; margin-left: 1em;">Skip to main content</a>
        </nav>
    </header>
    <main id="main-content" tabindex="-1">
        <h1>Accessible Weather Dashboard</h1>
        <section aria-labelledby="search-heading">
            <h2 id="search-heading" class="sr-only">City Weather Search</h2>
            <form id="weather-form" autocomplete="off" novalidate aria-describedby="city-error" aria-label="Search for city weather">
                <div class="form-group">
                    <label for="city-input">City Name <span class="required" aria-hidden="true">*</span></label>
                    <input 
                        type="text" 
                        id="city-input" 
                        name="city" 
                        required 
                        aria-required="true"
                        aria-describedby="city-error"
                        placeholder="e.g., London"
                        autocomplete="off"
                        inputmode="text"
                        pattern="^[a-zA-Z\s\-]+$"
                        aria-label="City Name"
                    >
                    <span id="city-error" class="error-message" role="alert" aria-live="assertive"></span>
                </div>
                <div>
                    <button type="submit" id="search-btn">Search Weather</button>
                </div>
            </form>
        </section>
        <section id="weather-section" class="weather-section" aria-live="polite" aria-atomic="true">
            <!-- Weather results dynamically inserted here -->
        </section>
    </main>
    <footer>
        <p>
            Weather data powered by <a href="https://open-meteo.com/" target="_blank" rel="noopener noreferrer" style="color: #fff; text-decoration: underline;">Open-Meteo</a>.
            <span aria-hidden="true">|</span>
            <span>Page designed for accessibility and inclusivity.</span>
        </p>
    </footer>
    <script>
        // Accessible Weather Dashboard JavaScript

        // Open-Meteo endpoints (no API key required)
        // 1. Geocoding: https://geocoding-api.open-meteo.com/v1/search?name={city}
        // 2. Weather: https://api.open-meteo.com/v1/forecast?latitude={lat}&longitude={lon}&current_weather=true&hourly=temperature_2m,weathercode

        // Weather code mapping (Open-Meteo standard)
        const weatherCodes = {
            0: { desc: "Clear sky", icon: "☀️", img: "clear-day" },
            1: { desc: "Mainly clear", icon: "🌤️", img: "mainly-clear" },
            2: { desc: "Partly cloudy", icon: "⛅", img: "partly-cloudy" },
            3: { desc: "Overcast", icon: "☁️", img: "overcast" },
            45: { desc: "Fog", icon: "🌫️", img: "fog" },
            48: { desc: "Depositing rime fog", icon: "🌫️", img: "fog" },
            51: { desc: "Light drizzle", icon: "🌦️", img: "drizzle" },
            53: { desc: "Moderate drizzle", icon: "🌦️", img: "drizzle" },
            55: { desc: "Dense drizzle", icon: "🌦️", img: "drizzle" },
            56: { desc: "Freezing light drizzle", icon: "🌧️", img: "drizzle" },
            57: { desc: "Freezing dense drizzle", icon: "🌧️", img: "drizzle" },
            61: { desc: "Slight rain", icon: "🌧️", img: "rain" },
            63: { desc: "Moderate rain", icon: "🌧️", img: "rain" },
            65: { desc: "Heavy rain", icon: "🌧️", img: "rain" },
            66: { desc: "Freezing light rain", icon: "🌧️", img: "rain" },
            67: { desc: "Freezing heavy rain", icon: "🌧️", img: "rain" },
            71: { desc: "Slight snow fall", icon: "🌨️", img: "snow" },
            73: { desc: "Moderate snow fall", icon: "🌨️", img: "snow" },
            75: { desc: "Heavy snow fall", icon: "🌨️", img: "snow" },
            77: { desc: "Snow grains", icon: "🌨️", img: "snow" },
            80: { desc: "Slight rain showers", icon: "🌦️", img: "showers" },
            81: { desc: "Moderate rain showers", icon: "🌦️", img: "showers" },
            82: { desc: "Violent rain showers", icon: "🌦️", img: "showers" },
            85: { desc: "Slight snow showers", icon: "🌨️", img: "snow" },
            86: { desc: "Heavy snow showers", icon: "🌨️", img: "snow" },
            95: { desc: "Thunderstorm", icon: "⛈️", img: "thunderstorm" },
            96: { desc: "Thunderstorm with slight hail", icon: "⛈️", img: "thunderstorm" },
            99: { desc: "Thunderstorm with heavy hail", icon: "⛈️", img: "thunderstorm" }
        };

        // Helper: Get weather icon SVG URL (for alt text, use weatherCodes[code].desc)
        function getWeatherIconURL(code) {
            // For demonstration, we use simple open source icons from Open-Meteo CDN
            // (In production, host your own or use inline SVG for full control)
            // https://open-meteo.com/images/weather-icons/
            const imgName = weatherCodes[code]?.img || "unknown";
            return `https://open-meteo.com/images/weather-icons/${imgName}.svg`;
        }

        // Focus management: move focus to main content after search
        function focusMainContent() {
            const main = document.getElementById('main-content');
            if (main) {
                main.focus();
            }
        }

        // Accessible error handling for form
        function showError(message) {
            const errorSpan = document.getElementById('city-error');
            errorSpan.textContent = message;
        }
        function clearError() {
            showError('');
        }

        // Keyboard support for Search button (redundant with native <button>, but shown for pattern compliance)
        function handleSearchBtnInteraction(event) {
            if (
                event.type === 'click' ||
                (event.type === 'keydown' && (event.key === 'Enter' || event.key === ' '))
            ) {
                event.preventDefault();
                document.getElementById('weather-form').dispatchEvent(new Event('submit', { cancelable: true }));
            }
        }
        document.addEventListener('DOMContentLoaded', function() {
            const searchBtn = document.getElementById('search-btn');
            searchBtn.addEventListener('keydown', handleSearchBtnInteraction);
        });

        // Form submission handler
        document.getElementById('weather-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            clearError();
            const cityInput = document.getElementById('city-input');
            const city = cityInput.value.trim();
            // Validate input: required, only letters, spaces, hyphens
            if (!city) {
                showError('Please enter a city name.');
                cityInput.setAttribute('aria-invalid', 'true');
                cityInput.focus();
                return;
            }
            if (!/^[a-zA-Z\s\-]+$/.test(city)) {
                showError('City name must contain only letters, spaces, or hyphens.');
                cityInput.setAttribute('aria-invalid', 'true');
                cityInput.focus();
                return;
            }
            cityInput.removeAttribute('aria-invalid');
            showWeatherLoading();
            try {
                // 1. Geocode city name
                const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=en&format=json`);
                if (!geoRes.ok) throw new Error('Failed to fetch city location.');
                const geoData = await geoRes.json();
                if (!geoData.results || geoData.results.length === 0) {
                    showWeatherError(`No results found for "${city}". Please check your spelling.`);
                    return;
                }
                const location = geoData.results[0];
                // 2. Fetch weather data
                const lat = location.latitude;
                const lon = location.longitude;
                // Get user's local time zone for accurate hourly forecast
                const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || location.timezone || 'auto';
                const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,weathercode&timezone=${encodeURIComponent(tz)}`;
                const weatherRes = await fetch(weatherUrl);
                if (!weatherRes.ok) throw new Error('Failed to fetch weather data.');
                const weatherData = await weatherRes.json();
                renderWeather(location, weatherData);
                focusMainContent();
            } catch (err) {
                showWeatherError('Unable to retrieve weather data. Please try again later.');
            }
        });

        // Show loading state
        function showWeatherLoading() {
            const section = document.getElementById('weather-section');
            section.innerHTML = `<div role="status" aria-live="polite" style="font-size:1.2rem; text-align:center;">
                <span aria-hidden="true" style="font-size:2rem;">⏳</span>
                <span>Loading weather data...</span>
            </div>`;
        }

        // Show error state in weather section
        function showWeatherError(msg) {
            const section = document.getElementById('weather-section');
            section.innerHTML = `<div class="error-message" role="alert" aria-live="assertive" style="font-size:1.1rem; text-align:center;">
                <span aria-hidden="true" style="font-size:1.5rem;">⚠️</span>
                <span>${msg}</span>
            </div>`;
        }

        // Render weather data
        function renderWeather(location, weatherData) {
            const section = document.getElementById('weather-section');
            // Current weather
            const current = weatherData.current_weather;
            const currentTemp = typeof current.temperature === 'number' ? Math.round(current.temperature) : '--';
            const currentCode = current.weathercode;
            const currentDesc = weatherCodes[currentCode]?.desc || 'Unknown conditions';
            const currentIconURL = getWeatherIconURL(currentCode);
            // Timezone-aware date/time
            const now = new Date(current.time);
            // 24-hour forecast
            const hourlyTimes = weatherData.hourly.time;
            const hourlyTemps = weatherData.hourly.temperature_2m;
            const hourlyCodes = weatherData.hourly.weathercode;
            // Find the index for the current hour
            let nowIdx = hourlyTimes.findIndex(t => t === current.time);
            if (nowIdx === -1) nowIdx = 0;
            // Get next 24 hours
            const forecastHours = [];
            for (let i = nowIdx; i < Math.min(nowIdx + 24, hourlyTimes.length); i++) {
                forecastHours.push({
                    time: hourlyTimes[i],
                    temp: Math.round(hourlyTemps[i]),
                    code: hourlyCodes[i]
                });
            }
            // Format location (city, country, admin1)
            const locationParts = [location.name];
            if (location.admin1) locationParts.push(location.admin1);
            if (location.country) locationParts.push(location.country);
            const locationStr = locationParts.join(', ');

            // Build current weather HTML
            section.innerHTML = `
                <article class="current-weather" aria-labelledby="current-weather-heading">
                    <img 
                        src="${currentIconURL}" 
                        alt="${currentDesc}" 
                        class="weather-icon"
                        width="80" height="80"
                        aria-hidden="false"
                    >
                    <div class="weather-details">
                        <h2 id="current-weather-heading">Current Weather for <span>${escapeHTML(locationStr)}</span></h2>
                        <div class="temperature" aria-label="Current temperature">${currentTemp}&deg;C</div>
                        <div class="condition">${currentDesc}</div>
                        <div style="font-size:0.95rem; color:var(--text-secondary); margin-top:0.5em;">
                            <span aria-label="Last updated">As of ${formatTime(now, location.timezone)}</span>
                        </div>
                    </div>
                </article>
                <section class="forecast-section" aria-labelledby="forecast-heading">
                    <h2 id="forecast-heading">24-Hour Forecast</h2>
                    <ul class="forecast-list" role="list">
                        ${forecastHours.map(hour => {
                            const dt = new Date(hour.time);
                            const code = hour.code;
                            const desc = weatherCodes[code]?.desc || 'Unknown';
                            const iconURL = getWeatherIconURL(code);
                            return `
                                <li class="forecast-item" role="listitem" aria-label="${formatTime(dt, location.timezone, true)}: ${desc}, ${hour.temp}°C">
                                    <img 
                                        src="${iconURL}" 
                                        alt="${desc}" 
                                        class="forecast-icon"
                                        width="40" height="40"
                                        aria-hidden="false"
                                    >
                                    <div class="forecast-time">${formatTime(dt, location.timezone, true)}</div>
                                    <div class="forecast-temp">${hour.temp}&deg;C</div>
                                    <div class="forecast-condition">${desc}</div>
                                </li>
                            `;
                        }).join('')}
                    </ul>
                </section>
            `;
        }

        // Helper: Format time (hour, minute)
        function formatTime(date, tz, short=false) {
            try {
                const options = {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false,
                    timeZone: tz || undefined
                };
                if (!short) {
                    options.weekday = 'short';
                    options.day = '2-digit';
                    options.month = 'short';
                }
                return date.toLocaleString(undefined, options);
            } catch {
                return date.toLocaleString();
            }
        }

        // Helper: Escape HTML for safe rendering
        function escapeHTML(str) {
            return String(str)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Accessibility: allow skip link to work
        document.querySelector('.skip-link').addEventListener('click', function(e) {
            e.preventDefault();
            focusMainContent();
        });

        // Accessibility: Ensure focus is visible after clicking skip link (esp. for keyboard users)
        document.getElementById('main-content').addEventListener('focus', function() {
            this.style.outline = '3px solid var(--focus)';
            this.style.outlineOffset = '2px';
        });
        document.getElementById('main-content').addEventListener('blur', function() {
            this.style.outline = 'none';
        });

        // Accessibility: Remove error message when user starts typing again
        document.getElementById('city-input').addEventListener('input', function() {
            clearError();
            this.removeAttribute('aria-invalid');
        });

        // Initial message
        document.getElementById('weather-section').innerHTML = `
            <div style="font-size:1.1rem; color:var(--text-secondary); text-align:center;">
                <span aria-hidden="true" style="font-size:1.5rem;">🔍</span>
                <span>Enter a city name and press "Search Weather" to view current conditions and a 24-hour forecast.</span>
            </div>
        `;
    </script>
</body>
</html>
