<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event RSVP – Confirm Your Attendance</title>
    <meta name="description" content="Accessible RSVP page for confirming attendance to the event, submitting details, and viewing attendees. Fully WCAG 2.1 AA compliant.">
    <style>
        :root {
            --primary: #0066cc;
            --primary-dark: #004999;
            --accent: #18a058;
            --danger: #c82333;
            --bg: #f7f9fa;
            --text: #1a1a1a;
            --border: #e1e4e8;
            --radius: 8px;
            --focus-outline: 3px solid var(--primary);
            --focus-outline-dark: 3px solid #fff;
            --transition: 0.25s cubic-bezier(0.4,0,0.2,1);
        }

        html {
            box-sizing: border-box;
            font-size: 100%;
        }
        *, *::before, *::after {
            box-sizing: inherit;
        }
        body {
            margin: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header, footer {
            background: #fff;
            border-bottom: 1px solid var(--border);
        }
        header {
            padding: 1rem 0;
        }
        nav {
            display: flex;
            justify-content: center;
            gap: 2rem;
        }
        nav a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            position: relative;
        }
        nav a:focus {
            outline: var(--focus-outline);
            outline-offset: 2px;
            background: #e6f0fa;
            border-radius: 4px;
        }
        main {
            flex: 1 0 auto;
            max-width: 600px;
            margin: 2rem auto;
            background: #fff;
            border-radius: var(--radius);
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            padding: 2rem 1.5rem;
        }
        h1 {
            margin-top: 0;
            font-size: 2rem;
            color: var(--primary-dark);
        }
        section {
            margin-bottom: 2rem;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        label {
            font-weight: 600;
            margin-bottom: 0.15rem;
        }
        .required {
            color: var(--danger);
            margin-left: 0.25em;
            font-size: 1.1em;
        }
        input, select {
            padding: 0.5em 0.75em;
            font-size: 1rem;
            border: 1.5px solid var(--border);
            border-radius: 4px;
            transition: border-color var(--transition);
            background: #f9fbfc;
            color: var(--text);
        }
        input:focus, select:focus, textarea:focus {
            outline: var(--focus-outline);
            border-color: var(--primary);
            background: #e6f0fa;
        }
        .error {
            color: var(--danger);
            font-size: 0.97em;
            margin-top: 0.15em;
            min-height: 1.3em;
        }
        button[type="submit"] {
            background: var(--primary);
            color: #fff;
            font-weight: 700;
            border: none;
            border-radius: 4px;
            padding: 0.75em 1.5em;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background var(--transition), transform var(--transition);
            box-shadow: 0 1px 4px rgba(0,0,0,0.04);
            margin-top: 0.5em;
        }
        button[type="submit"]:hover, button[type="submit"]:focus-visible {
            background: var(--primary-dark);
            transform: translateY(-2px) scale(1.03);
        }
        button[type="submit"]:focus {
            outline: var(--focus-outline);
            outline-offset: 2px;
        }
        .confirmation {
            background: #e6f7ea;
            border-left: 5px solid var(--accent);
            color: #22543d;
            padding: 1em 1.5em;
            border-radius: 4px;
            margin-bottom: 1.5em;
            font-size: 1.05em;
            animation: fadeIn 0.7s cubic-bezier(0.4,0,0.2,1);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(16px);}
            to { opacity: 1; transform: translateY(0);}
        }
        .attendees-list {
            margin-top: 1.5em;
        }
        .attendees-list h2 {
            font-size: 1.25rem;
            margin-bottom: 0.75em;
        }
        ul.attendees {
            list-style: disc inside;
            padding: 0;
            margin: 0;
        }
        ul.attendees li {
            padding: 0.5em 0.25em;
            border-bottom: 1px solid #f0f0f0;
            animation: fadeIn 0.5s;
        }
        .no-attendees {
            color: #888;
            font-style: italic;
            margin-top: 0.5em;
        }
        /* Responsive design */
        @media (max-width: 700px) {
            main {
                padding: 1rem 0.5rem;
            }
        }
        @media (max-width: 480px) {
            main {
                margin: 0.5rem;
            }
            h1 {
                font-size: 1.25rem;
            }
        }
        /* Required focus indicators for accessibility */
        button:focus, input:focus, select:focus, textarea:focus, a:focus {
            outline: var(--focus-outline);
            outline-offset: 2px;
        }
        /* High contrast focus for dark backgrounds */
        .dark-bg button:focus, .dark-bg a:focus {
            outline: var(--focus-outline-dark);
        }
        /* Hide visually but keep accessible for screen readers */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            border: 0;
        }
    </style>
</head>
<body>
    <header>
        <nav role="navigation" aria-label="Main navigation">
            <a href="#rsvp-section">RSVP</a>
            <a href="#attendees-section">View Attendees</a>
        </nav>
    </header>
    <main>
        <h1>Event RSVP – Confirm Your Attendance</h1>
        <section id="rsvp-section" aria-labelledby="rsvp-heading">
            <h2 id="rsvp-heading">RSVP Form</h2>
            <p>Please fill in your details to confirm your attendance. Fields marked with <span class="required" aria-hidden="true">*</span> are required.</p>
            <form id="rsvpForm" novalidate autocomplete="off" aria-describedby="rsvp-instructions">
                <div id="rsvp-instructions" class="sr-only">
                    Fill in your name and email. Phone number is optional. Use the submit button to confirm attendance.
                </div>
                <div class="form-group">
                    <label for="name">
                        Full Name <span class="required" aria-hidden="true">*</span>
                    </label>
                    <input type="text" id="name" name="name" required aria-required="true" autocomplete="name" aria-describedby="name-error" maxlength="80" />
                    <span id="name-error" class="error" aria-live="polite"></span>
                </div>
                <div class="form-group">
                    <label for="email">
                        Email Address <span class="required" aria-hidden="true">*</span>
                    </label>
                    <input type="email" id="email" name="email" required aria-required="true" autocomplete="email" aria-describedby="email-error" maxlength="80" />
                    <span id="email-error" class="error" aria-live="polite"></span>
                </div>
                <div class="form-group">
                    <label for="phone">
                        Phone Number (optional)
                    </label>
                    <input type="tel" id="phone" name="phone" autocomplete="tel" aria-describedby="phone-error" maxlength="20" pattern="^[\d\s\-\+\(\)]*$" />
                    <span id="phone-error" class="error" aria-live="polite"></span>
                </div>
                <button type="submit" id="submitBtn">Confirm Attendance</button>
            </form>
            <div id="confirmation" class="confirmation" role="status" aria-live="polite" style="display:none;"></div>
        </section>
        <section id="attendees-section" class="attendees-list" aria-labelledby="attendees-heading">
            <h2 id="attendees-heading">List of Attendees</h2>
            <ul id="attendees" class="attendees" aria-live="polite" aria-relevant="additions removals">
                <!-- Attendees dynamically inserted here -->
            </ul>
            <div id="no-attendees" class="no-attendees">No attendees yet.</div>
        </section>
    </main>
    <footer>
        <div style="text-align:center; padding:1em 0; font-size:0.98em; color:#555;">
            &copy; <span id="year"></span> Accessible Event RSVP. All rights reserved.
        </div>
    </footer>
    <script>
        // Utility: Set current year in footer
        document.getElementById('year').textContent = new Date().getFullYear();

        // Attendees storage (localStorage for persistence)
        const ATTENDEES_KEY = 'accessible_event_attendees';

        // Get DOM elements
        const form = document.getElementById('rsvpForm');
        const confirmation = document.getElementById('confirmation');
        const attendeesList = document.getElementById('attendees');
        const noAttendees = document.getElementById('no-attendees');
        const submitBtn = document.getElementById('submitBtn');

        // Error spans
        const nameError = document.getElementById('name-error');
        const emailError = document.getElementById('email-error');
        const phoneError = document.getElementById('phone-error');

        // Helper: Validate email format
        function isValidEmail(email) {
            // Basic RFC 5322 compliant regex
            return /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(email);
        }

        // Helper: Validate phone (optional, only digits, spaces, dashes, plus, parens)
        function isValidPhone(phone) {
            return phone === '' || /^[\d\s\-\+\(\)]*$/.test(phone);
        }

        // Accessibility: Keyboard support for submit button (redundant for native button, but pattern included)
        function handleInteraction(event) {
            if (event.type === 'click' ||
                (event.type === 'keydown' && (event.key === 'Enter' || event.key === ' '))) {
                event.preventDefault();
                submitBtn.click();
            }
        }
        submitBtn.onkeydown = handleInteraction;

        // Form Validation
        function validateForm() {
            let valid = true;
            // Reset errors
            nameError.textContent = '';
            emailError.textContent = '';
            phoneError.textContent = '';

            // Name validation
            const name = form.name.value.trim();
            if (!name) {
                nameError.textContent = 'Full name is required.';
                valid = false;
            } else if (name.length > 80) {
                nameError.textContent = 'Name is too long.';
                valid = false;
            }

            // Email validation
            const email = form.email.value.trim();
            if (!email) {
                emailError.textContent = 'Email address is required.';
                valid = false;
            } else if (!isValidEmail(email)) {
                emailError.textContent = 'Please enter a valid email address.';
                valid = false;
            } else if (email.length > 80) {
                emailError.textContent = 'Email is too long.';
                valid = false;
            }

            // Phone validation (optional)
            const phone = form.phone.value.trim();
            if (phone && !isValidPhone(phone)) {
                phoneError.textContent = 'Please enter a valid phone number.';
                valid = false;
            } else if (phone.length > 20) {
                phoneError.textContent = 'Phone number is too long.';
                valid = false;
            }

            return valid;
        }

        // Save attendee to localStorage
        function saveAttendee(attendee) {
            let attendees = JSON.parse(localStorage.getItem(ATTENDEES_KEY)) || [];
            // Prevent duplicate emails (case-insensitive)
            if (!attendees.some(a => a.email.toLowerCase() === attendee.email.toLowerCase())) {
                attendees.push(attendee);
                localStorage.setItem(ATTENDEES_KEY, JSON.stringify(attendees));
                return true;
            }
            return false;
        }

        // Render attendees list
        function renderAttendees() {
            const attendees = JSON.parse(localStorage.getItem(ATTENDEES_KEY)) || [];
            attendeesList.innerHTML = '';
            if (attendees.length === 0) {
                noAttendees.style.display = 'block';
                attendeesList.setAttribute('aria-hidden', 'true');
            } else {
                noAttendees.style.display = 'none';
                attendeesList.setAttribute('aria-hidden', 'false');
                attendees.forEach(att => {
                    // Only display name and optionally phone (never email for privacy)
                    const li = document.createElement('li');
                    li.tabIndex = 0; // Allow keyboard focus for screen reader context
                    li.innerHTML = `<strong>${att.name}</strong>` +
                        (att.phone ? ` <span aria-label="Phone number">(${att.phone})</span>` : '');
                    attendeesList.appendChild(li);
                });
            }
        }

        // Show confirmation message with animation
        function showConfirmation(name) {
            confirmation.textContent = `Thank you, ${name}! Your attendance has been confirmed.`;
            confirmation.style.display = 'block';
            confirmation.setAttribute('tabindex', '-1');
            confirmation.focus();
            setTimeout(() => {
                confirmation.style.display = 'none';
            }, 4500);
        }

        // On form submit
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            if (!validateForm()) {
                // Focus first error field for accessibility
                if (nameError.textContent) {
                    form.name.focus();
                } else if (emailError.textContent) {
                    form.email.focus();
                } else if (phoneError.textContent) {
                    form.phone.focus();
                }
                return;
            }
            const attendee = {
                name: form.name.value.trim(),
                email: form.email.value.trim(),
                phone: form.phone.value.trim()
            };
            // Save attendee and check for duplicates
            if (saveAttendee(attendee)) {
                renderAttendees();
                showConfirmation(attendee.name);
                form.reset();
                form.name.focus();
            } else {
                emailError.textContent = 'This email has already been used to RSVP.';
                form.email.focus();
            }
        });

        // Accessibility: clear error on input
        ['name', 'email', 'phone'].forEach(field => {
            form[field].addEventListener('input', function() {
                document.getElementById(field + '-error').textContent = '';
            });
        });

        // On page load, render attendees
        window.addEventListener('DOMContentLoaded', function() {
            renderAttendees();
        });

        // Accessibility: Ensure focus indicator visible for keyboard users
        // (CSS already covers this, but for browsers that suppress outline on mouse)
        document.body.addEventListener('mousedown', function(e) {
            if (e.target.matches('button, input, select, textarea, a')) {
                e.target.style.outline = 'none';
            }
        });
        document.body.addEventListener('keydown', function(e) {
            if (e.target.matches('button, input, select, textarea, a')) {
                e.target.style.outline = '';
            }
        });
    </script>
    <!--
        Accessibility Notes:
        - All form fields have <label> with "for" matching input "id".
        - Required fields use both visual (red asterisk) and programmatic (aria-required) indicators.
        - Error messages are associated with fields using aria-describedby and aria-live.
        - Focus indicators are visible and high contrast.
        - Attendees list uses <ul> and <li> with semantic structure.
        - Confirmation uses role="status" and aria-live for assistive tech.
        - Keyboard navigation is fully supported.
        - No information is conveyed by color alone.
        - Responsive design and sufficient color contrast throughout.
    -->
</body>
</html>
